<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IoT Dashboard - PÅ™ipojenÃ­ k ESP32</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>ğŸŒ¡ï¸ IoT Dashboard</h2>
                <div class="connection-status">
                    <span class="status-dot" id="status-dot"></span>
                    <span id="connection-status">Odpojeno</span>
                </div>
            </div>
            <ul class="sidebar-nav">
                <li><a href="{{ url_for('connect_page') }}" class="nav-link active">ğŸ”Œ PÅ™ipojenÃ­</a></li>
                <li><a href="{{ url_for('index') }}" class="nav-link">ğŸ“ˆ PÅ™ehled</a></li>
                <li><a href="{{ url_for('sensors_page') }}" class="nav-link">ğŸ”Œ Senzory</a></li>
                <li><a href="{{ url_for('live_data') }}" class="nav-link">ğŸ“Š Å½ivÃ¡ data</a></li>
                <li><a href="{{ url_for('devices_page') }}" class="nav-link">ğŸ’¡ ZaÅ™Ã­zenÃ­</a></li>
            </ul>
        </nav>

        <!-- HlavnÃ­ obsah -->
        <main class="main-content">
            <header class="content-header">
                <h1>ğŸ”Œ PÅ™ipojenÃ­ k ESP32</h1>
            </header>

            <!-- Stav pÅ™ipojenÃ­ -->
            <section class="connection-status-card">
                <h2>Stav pÅ™ipojenÃ­</h2>
                <div class="status-info">
                    <div class="status-item">
                        <span class="status-label">Typ:</span>
                        <span id="current-type" class="status-value">Å½Ã¡dnÃ©</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">Stav:</span>
                        <span id="current-status" class="status-value offline">Odpojeno</span>
                    </div>
                    <div class="status-item">
                        <span class="status-label">PoslednÃ­ data:</span>
                        <span id="last-data" class="status-value">Å½Ã¡dnÃ¡</span>
                    </div>
                </div>
            </section>

            <!-- PÅ™ipojenÃ­ k reÃ¡lnÃ©mu ESP32 -->
            <section class="connection-section">
                <h2>ğŸ“¡ PÅ™ipojit k reÃ¡lnÃ©mu ESP32</h2>
                <form id="real-esp32-form" class="connection-form">
                    <div class="form-group">
                        <label for="esp32-ip">IP adresa ESP32:</label>
                        <input type="text" id="esp32-ip" value="192.168.1.100" placeholder="napÅ™. 192.168.1.100">
                    </div>
                    <div class="form-group">
                        <label for="esp32-port">Port:</label>
                        <input type="number" id="esp32-port" value="5000" placeholder="5000">
                    </div>
                    <button type="submit" class="btn btn-primary">ğŸ”— PÅ™ipojit k ESP32</button>
                </form>
            </section>

            <!-- VirtuÃ¡lnÃ­ ESP32 -->
            <section class="connection-section">
                <h2>ğŸ–¥ï¸ Spustit virtuÃ¡lnÃ­ ESP32</h2>
                <p class="description">VirtuÃ¡lnÃ­ ESP32 generuje nÃ¡hodnÃ¡ testovacÃ­ data pro vÃ½voj a testovÃ¡nÃ­.</p>
                <button id="virtual-esp32-btn" class="btn btn-secondary">ğŸ® Spustit virtuÃ¡lnÃ­ ESP32</button>
            </section>

            <!-- OdpojenÃ­ -->
            <section class="connection-section">
                <h2>âŒ Odpojit</h2>
                <button id="disconnect-btn" class="btn btn-danger" disabled>ğŸ”Œ Odpojit od ESP32</button>
            </section>

            <!-- NÃ¡hled dat -->
            <section class="data-preview">
                <h2>ğŸ“Š NÃ¡hled pÅ™ijÃ­manÃ½ch dat</h2>
                <div class="data-container">
                    <pre id="data-preview">ÄŒekÃ¡m na data...</pre>
                </div>
            </section>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script src="{{ url_for('static', filename='js/websocket.js') }}"></script>
    
    <script>
        // SpecifickÃ½ kÃ³d pro strÃ¡nku pÅ™ipojenÃ­
        document.addEventListener('DOMContentLoaded', function() {
            // FormulÃ¡Å™ pro reÃ¡lnÃ© ESP32
            document.getElementById('real-esp32-form').addEventListener('submit', function(e) {
                e.preventDefault();
                connectToRealESP32();
            });

            // TlaÄÃ­tko pro virtuÃ¡lnÃ­ ESP32
            document.getElementById('virtual-esp32-btn').addEventListener('click', connectToVirtualESP32);
            
            // TlaÄÃ­tko pro odpojenÃ­
            document.getElementById('disconnect-btn').addEventListener('click', disconnectESP32);

            // NaÄtenÃ­ stavu pÅ™i startu
            checkConnectionStatus();
        });

        async function connectToRealESP32() {
            const ip = document.getElementById('esp32-ip').value;
            const port = document.getElementById('esp32-port').value;

            try {
                const response = await fetch('/api/connect/real', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ ip, port })
                });

                const result = await response.json();
                showMessage(result.message, result.status);
                
            } catch (error) {
                showMessage('Chyba pÅ™ipojenÃ­: ' + error, 'error');
            }
        }

        async function connectToVirtualESP32() {
            try {
                const response = await fetch('/api/connect/virtual', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                showMessage(result.message, result.status);
                
            } catch (error) {
                showMessage('Chyba: ' + error, 'error');
            }
        }

        async function disconnectESP32() {
            try {
                const response = await fetch('/api/disconnect', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' }
                });

                const result = await response.json();
                showMessage(result.message, result.status);
                
            } catch (error) {
                showMessage('Chyba odpojenÃ­: ' + error, 'error');
            }
        }

        function showMessage(message, type) {
            // JednoduchÃ© zobrazenÃ­ zprÃ¡vy
            alert(`[${type.toUpperCase()}] ${message}`);
        }

        function checkConnectionStatus() {
            fetch('/api/status')
                .then(response => response.json())
                .then(data => {
                    updateConnectionStatus(data);
                });
        }

        function updateConnectionStatus(status) {
            const typeElem = document.getElementById('current-type');
            const statusElem = document.getElementById('current-status');
            const disconnectBtn = document.getElementById('disconnect-btn');

            typeElem.textContent = status.type || 'Å½Ã¡dnÃ©';
            statusElem.textContent = status.connected ? 'PÅ™ipojeno' : 'Odpojeno';
            statusElem.className = status.connected ? 'status-value online' : 'status-value offline';
            disconnectBtn.disabled = !status.connected;
        }
    </script>
</body>
</html>